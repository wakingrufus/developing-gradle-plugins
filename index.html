<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css">
    <style>
        .grid-area {
            display: grid;
            grid-auto-flow: column;
        }

        .reveal pre code {
            max-height: none;
        }

        .reveal pre {
            width: 100%;
        }

        .inline-image img {
            margin: 0;
        }
        .inline-image {
            display: inline-flex;
        }
    </style>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <h1>Gradle Plugins</h1>
        </section>
        <section data-timing="60">
            <h1>About Me</h1>
            <aside class="notes">
                You can also find me on the Chicago Tech and Kotlin slacks and the CJUG discord
            </aside>
            <h3>John Burns</h3>
            <div class="grid-area">
                <div style="text-align: left">
                    <p>Staff Engineer @ GrubHub</p>
                    <p>CKUG Co-Organizer</p>
                    <p class="inline-image"><img alt="twitter logo" src="Twitter-Logo.png" height="48" width="48"/><span style="padding-left: .5em">@wakingrufus</span></p>
                    <p class="inline-image"><img alt="fediverse logo" src="fediverse.png" height="48" width="48"/><span style="padding-left: .5em">@wakingrufus@mastodon.technology</span></p>
                </div>
            </div>
        </section>
        <section>About GrubHub</section>
        <section>About You</section>
        <section>
            <section data-timing="120">
                <h1>The Problem</h1>
                <aside class="notes">
                    Every team has just one person who actually understand the buildscripts. if you are lucky, 2.
                    usually it starts when something breaks,
                    and 1 person figures out how to fix it, and in doing so they learn about how it works.
                    then next time something breaks, the person it breaks for gets frustrated b/c they just want their
                    code to run dangit!
                    not understanding the arcane workings of a build tool.
                    so after trying and failing a few times, they just go to the person who fixed it before, and they
                    figure it out
                    and this happens again and again,
                    until the fixer is spending most of their time just fixing people problems instead of doing their
                    real job
                    but then before they realize it buildscripts ARE their real job
                    and all of a sudden they are on stage talking to a bunch of people about gradle plugins!
                </aside>
            </section>
            <section data-timing="120">
                <h2>Not everyone should NEED to know how the buildscripts work</h2>
            </section>
            <section data-timing="120">
                <h2>Maven vs Gradle</h2>
                <div class="grid-area">
                    <div class="fragment">
                        <h3>Maven</h3>
                        <ul>
                            <li>Declarative via XML</li>
                            <li>Extended with Plugins</li>
                        </ul>
                    </div>
                    <div class="fragment">
                        <h3>Gradle</h3>
                        <ul>
                            <li>DSL</li>
                            <li>Extended with Plugins</li>
                        </ul>
                    </div>
                </div>
                <aside class="notes">
                    with either tool, we can use plugins to abstract away complexity and follow DRY principles
                    but the gradle DSL is a blessing and a curse
                </aside>
            </section>
            <section>
                <h1>DSL</h1>
                <aside class="notes">
                    Here, the DSL looks very declarative great right?
                </aside>
                <pre class="groovy"><code data-trim data-noescape>
plugins {
  id "java"
  id "jacoco"
}
repositories {
  mavenCentral()
}
dependencies {
  implementations("commons-io:commons-io:2.7")

  testImplementation("org.junit.jupiter:junit-jupiter-api:5.4.+")
  testRuntimeOnly("org.junit.jupiter:junit-jupiter-engine:5.4.+")
  testImplementation("org.junit.jupiter:junit-jupiter-params:5.4.+")
  testImplementation("org.assertj:assertj-core:3.23.1")
}
test {
  useJUnitPlatform()
}

                </code></pre>
            </section>
            <section>
                <h1>DSL</h1>
                <aside class="notes">
                    But say we need something a little custom
                    This is a real customization of the dependencyUpdates plugin.
                    This is not declarative. There is a lot of code here. complexity. regex!
                    so someone writes this, then everyone else copies this magical incantation,
                    and if you ever want to change it, you have 1000 places you need to change it.
                </aside>
                <pre class="groovy"><code data-trim data-noescape>
def isNonStable = { String version ->
    def stableKeyword = ['RELEASE', 'FINAL', 'GA']
        .any { it -> version.toUpperCase().contains(it) }
    def regex = /^[0-9,.v-]+(-r)?$/
    return !stableKeyword && !(version ==~ regex)
}
def excludeList = ["guice", "guava"]
tasks.named("dependencyUpdates").configure {
    resolutionStrategy {
        componentSelection {
            all {
                if (isNonStable(it.candidate.version)) {
                    reject('Release candidate')
                } else if (excludeList.contains(it.candidate.module)){
                    reject('dependency excluded from upgrades')
                }
            }
        }
    }
}
                </code></pre>
            </section>
            <section>
                <h1>DSL</h1>
                <aside class="notes">
                    A gradle plugin can help you encapsulate shared/standard/conventional logic
                    make it reusable, DRY
                    the DSL is a slippery slope, so when do you use plugins?
                    for anything that is repeated in multiple project's build scripts
                    when everything is pluginified, then scripts are declarative
                    Before we talk about how to make a plugin, we first need to understand how gradle works
                </aside>
                <pre class="groovy"><code data-trim data-noescape>
                plugins {
                  id "java"
                  id "jacoco"
                  id "com.myorg.gradle.depupdates"
                }
                repositories {
                  mavenCentral()
                }
                dependencies {
                  implementations("commons-io:commons-io:2.7")

                  testImplementation("org.junit.jupiter:junit-jupiter-api:5.4.+")
                  testRuntimeOnly("org.junit.jupiter:junit-jupiter-engine:5.4.+")
                  testImplementation("org.junit.jupiter:junit-jupiter-params:5.4.+")
                  testImplementation("org.assertj:assertj-core:3.23.1")
                }
                test {
                  useJUnitPlatform()
                }
                </code></pre>
            </section>
        </section>
        <section>
            <section>
                <h1>Gradle lifecycle</h1>
                <aside class="notes">
                    Gradle builds run in 3 phases
                    buildSrc is your incubator. it is a great place to try writing custom tasks and plugins before pulling them out to a separate codebase / artifact
                </aside>
                <div class="grid-area">
                    <div class="fragment">
                        <h4>Initialization</h4>
                        <ul>
                            <li>buildSrc</li>
                            <li>init scripts</li>
                            <li>settings.gradle</li>
                        </ul>
                    </div>
                    <div class="fragment">
                        <h4>Configuration</h4>
                        <ul>
                            <li>Plugins</li>
                            <li>Build scripts</li>
                        </ul>
                    </div>
                    <div class="fragment">
                        <h4>Execution</h4>
                        <ul>
                            <li>Tasks</li>
                        </ul>
                    </div>
                </div>
            </section>
        </section>
        <section>
            <section>
                <h1>Groovy or Kotlin?</h1>
                <p class="fragment">Basic scripts: doesn't matter</p>
                <p class="fragment">Complex scripts: Groovy</p>
                <p class="fragment">Plugins: Kotlin</p>
            </section>
            <section>
                <h1>Groovy DSL</h1>
                <img src="groovy-dsl.png">
            </section>
            <section>
                <h1>Kotlin DSL</h1>
                <img src="kotlin-dsl.png">
            </section>
        </section>
        <section>
            <section>What plugins can do</section>
            <section>Apply Other Plugins</section>
            <section>Create Tasks</section>
            <section>Configure repositories / dependencies</section>
        </section>
        <section>
            <section>Custom Task Best Practices</section>
        </section>
        <section>
            <section>Plugin Best Practices</section>
            <section>Avoid afterEvaluate</section>
            <section>Extensions vs Properties</section>
        </section>
        <section>
            <section>Testing</section>
        </section>
        <section>
            <section>Custom Wrapper</section>
        </section>
    </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,
        defaultTiming: 120,
        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
    });

</script>
</body>
</html>
